<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - KSAU-HS - Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: #333;
            line-height: 1.6;
            overflow: hidden;
        }

        :root {
            --primary-green: #1B5E20;
            --light-green: #E8F5E9;
            --text-dark: #1a1a1a;
            --text-muted: #666;
        }

        /* ============================================
           LOGIN PAGE STYLES
           ============================================ */
        .login-container {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(27, 94, 32, 0.9) 0%, rgba(13, 59, 18, 0.95) 100%),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="1200" height="800" fill="url(%23grid)"/></svg>');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
            overflow: auto;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(27, 94, 32, 0.85) 0%, rgba(13, 59, 18, 0.88) 100%);
            z-index: 1;
        }

        .login-wrapper {
            position: relative;
            z-index: 2;
            display: flex;
            gap: 40px;
            max-width: 1200px;
            width: 100%;
            padding: 20px;
            align-items: center;
            justify-content: center;
        }

        .login-brand-section {
            flex: 1;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 500px;
        }

        .login-logo {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 10px;
        }

        .login-tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.6;
            color: #E8F5E9;
        }

        .login-features {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .feature-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .feature-text {
            flex: 1;
        }

        .feature-text h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            font-weight: 600;
            color: white;
        }

        .feature-text p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.85;
        }

        .login-form-section {
            flex: 1;
            max-width: 450px;
            width: 100%;
        }

        .login-form-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .login-form-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 10px;
            text-align: center;
        }

        .login-form-subtitle {
            font-size: 0.95rem;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(27, 94, 32, 0.1);
            background: #f9f9f9;
        }

        .form-group input::placeholder {
            color: #bbb;
        }

        .account-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .account-type-btn {
            padding: 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }

        .account-type-btn:hover {
            border-color: var(--primary-green);
            background: var(--light-green);
        }

        .account-type-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
            box-shadow: 0 8px 20px rgba(27, 94, 32, 0.3);
        }

        .account-type-icon {
            font-size: 1.8rem;
        }

        .login-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-green) 0%, #0D3B12 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(27, 94, 32, 0.4);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .demo-accounts {
            background: var(--light-green);
            border-left: 4px solid var(--primary-green);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 20px;
            color: var(--text-dark);
        }

        .demo-accounts strong {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-green);
            font-weight: 700;
        }

        .demo-account {
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }

        .demo-account:last-child {
            margin-bottom: 0;
        }

        .demo-account-type {
            font-weight: 600;
            color: var(--primary-green);
        }

        .demo-account-cred {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 3px;
            font-family: 'Courier New', monospace;
        }

        /* ============================================
           PORTAL STYLES
           ============================================ */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .app-container.hidden {
            display: none;
        }

        .global-nav {
            background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .global-nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .unit-nav-container {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
            width: 250px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .sidebar .brand {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 20px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: #666;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-link:hover {
            background: var(--light-green);
            color: var(--primary-green);
        }

        .nav-link.active {
            background: var(--light-green);
            color: var(--primary-green);
            font-weight: 600;
        }

        .nav-link.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .restricted-badge {
            display: inline-block;
            background: #FFE0B2;
            color: #E65100;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: auto;
        }

        .main-content {
            flex: 1;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .student-portal-home {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .home-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            font-size: 1.3rem;
            color: var(--primary-green);
        }

        .ticket-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #1B5E20;
            text-align: center;
        }

        .stat-card.active {
            border-left-color: #2196F3;
        }

        .stat-card.pending {
            border-left-color: #FF9800;
        }

        .stat-card.resolved {
            border-left-color: #9C27B0;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-green);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .quick-action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(27, 94, 32, 0.3);
        }

        .action-btn.secondary {
            background: var(--light-green);
            color: var(--primary-green);
        }

        .action-btn.secondary:hover {
            background: #C8E6C9;
            transform: translateY(-2px);
        }

        .ticket-preview-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-green);
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ticket-preview-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .ticket-status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .ticket-status-badge.submitted {
            background: #BBDEFB;
            color: #1565C0;
        }

        .ticket-status-badge.in-progress {
            background: #FFE0B2;
            color: #E65100;
        }

        .ticket-status-badge.closed,
        .ticket-status-badge.resolved,
        .ticket-status-badge.approved {
            background: #C8E6C9;
            color: #1B5E20;
        }

        .view-all {
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 600;
        }

        .view-all:hover {
            text-decoration: underline;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
        }

        .conversation-thread {
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .message.from-student {
            background: var(--light-green);
            margin-left: 40px;
            border-left: 3px solid var(--primary-green);
        }

        .message.from-admin {
            background: #F5F5F5;
            margin-right: 40px;
            border-left: 3px solid #999;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .message-header strong {
            font-weight: 600;
        }

        .message-body {
            color: var(--text-dark);
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .request-type-card {
            background: white;
            border: 2px solid #ddd;
            padding: 25px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .request-type-card:hover {
            border-color: var(--primary-green);
            box-shadow: 0 8px 20px rgba(27, 94, 32, 0.15);
            transform: translateY(-5px);
        }

        .request-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .ticket-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ticket-card:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-green);
        }

        @media (max-width: 1024px) {
            .login-wrapper {
                flex-direction: column;
                gap: 30px;
            }

            .login-brand-section {
                max-width: 100%;
            }

            .login-form-section {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                min-height: auto;
                padding: 15px;
            }

            .login-form-card {
                padding: 30px 20px;
            }

            .login-logo {
                font-size: 2.5rem;
            }

            .page-title {
                font-size: 1.3rem;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .account-type-selector {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================
         LOGIN PAGE
         ============================================ -->
    <div class="login-container" id="loginContainer">
        <div class="login-wrapper">
            <!-- Brand Section -->
            <div class="login-brand-section">
                <div class="login-logo">
                    üèõÔ∏è KSAU-HS<br>
                    <span style="font-size: 1.8rem; opacity: 0.9;">College of Pharmacy</span>
                </div>
                <p class="login-tagline">
                    Streamline your academic and clinical support requests. Track progress in real-time and connect with your college departments.
                </p>

                <div class="login-features">
                    <div class="feature-item">
                        <span class="feature-icon">üìã</span>
                        <div class="feature-text">
                            <h4>Easy Request Tracking</h4>
                            <p>Submit and monitor all your requests in one place</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üí¨</span>
                        <div class="feature-text">
                            <h4>Direct Communication</h4>
                            <p>Chat with coordinators and get real-time updates</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üìä</span>
                        <div class="feature-text">
                            <h4>Analytics Dashboard</h4>
                            <p>Visualize your request metrics and performance</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üîí</span>
                        <div class="feature-text">
                            <h4>Secure & Reliable</h4>
                            <p>Your data is protected with role-based access</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Login Form Section -->
            <div class="login-form-section">
                <div class="login-form-card">
                    <h2 class="login-form-title">Welcome Back</h2>
                    <p class="login-form-subtitle">Sign in to access the Student Portal</p>

                    <form onsubmit="AuthSystem.handleLogin(event)">
                        <!-- Account Type Selection -->
                        <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--text-dark); font-size: 0.95rem;">
                            Select Account Type
                        </label>
                        <div class="account-type-selector">
                            <button type="button" class="account-type-btn active" data-type="student" onclick="AuthSystem.selectAccountType('student')">
                                <span class="account-type-icon">üéì</span>
                                <span>Student Account</span>
                            </button>
                            <button type="button" class="account-type-btn" data-type="admin" onclick="AuthSystem.selectAccountType('admin')">
                                <span class="account-type-icon">üë®‚Äçüíº</span>
                                <span>Admin Account</span>
                            </button>
                        </div>

                        <!-- Student ID / Email -->
                        <div class="form-group">
                            <label id="idLabel">Student ID</label>
                            <input type="text" id="userId" placeholder="Enter your student ID" required>
                        </div>

                        <!-- Password -->
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="userPassword" placeholder="Enter your password" required>
                        </div>

                        <button type="submit" class="login-button">
                            <span>üîì Sign In</span>
                        </button>

                        <!-- Demo Accounts Info -->
                        <div class="demo-accounts">
                            <strong>üìå Demo Accounts</strong>
                            <div class="demo-account">
                                <span class="demo-account-type">üéì Student</span>
                                <div class="demo-account-cred">ID: 441210049 | Pass: 123456</div>
                            </div>
                            <div class="demo-account">
                                <span class="demo-account-type">üë®‚Äçüíº Admin</span>
                                <div class="demo-account-cred">ID: admin001 | Pass: admin123</div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         PORTAL PAGE (Hidden Initially)
         ============================================ -->
    <div class="app-container hidden" id="portalContainer">
        <!-- Global Navigation -->
        <nav class="global-nav">
            <div class="global-nav-brand">
                <span>üèõÔ∏è</span> College of Pharmacy - Student Portal
            </div>
            <button class="logout-btn" onclick="AuthSystem.logout()">üîí Logout</button>
        </nav>

        <!-- Unit Navigation -->
        <div class="unit-nav-container">
            <aside class="sidebar" id="nav-student-portal">
                <div class="brand">üë®‚Äçüéì Student Portal</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link" onclick="StudentPortal.renderHome(); return false;" style="cursor: pointer;">
                            <span>üè†</span> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="StudentPortal.showDashboard(); return false;" style="cursor: pointer;">
                            <span>üìä</span> Dashboard
                        </a>
                    </li>
                </ul>
            </aside>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title" id="page-title">Welcome to Student Portal</h1>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <span id="userGreeting" style="font-weight: 600; color: var(--text-dark);"></span>
                </div>
            </header>

            <div class="content-area" id="app-root">
                <div class="home-section" style="text-align: center; padding: 60px 20px;">
                    <p style="font-size: 3rem; margin-bottom: 20px;">üëã</p>
                    <h2 style="color: var(--primary-green); margin-bottom: 10px;">Welcome to Student Portal</h2>
                    <p style="color: var(--text-muted); margin-bottom: 30px;">Click Home or Dashboard in the sidebar to get started</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ============================================================
        // AUTHENTICATION SYSTEM
        // ============================================================
        const AuthSystem = {
            currentUser: null,
            selectedAccountType: 'student',

            selectAccountType: (type) => {
                AuthSystem.selectedAccountType = type;
                const buttons = document.querySelectorAll('.account-type-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-type="${type}"]`).classList.add('active');
                
                const idLabel = document.getElementById('idLabel');
                const userIdInput = document.getElementById('userId');
                
                if (type === 'student') {
                    idLabel.textContent = 'Student ID';
                    userIdInput.placeholder = 'Enter your student ID';
                } else {
                    idLabel.textContent = 'Admin ID / Email';
                    userIdInput.placeholder = 'Enter your admin ID';
                }
            },

            handleLogin: (event) => {
                event.preventDefault();
                
                const userId = document.getElementById('userId').value;
                const userPassword = document.getElementById('userPassword').value;
                const accountType = AuthSystem.selectedAccountType;

                // Demo credentials
                const studentAuth = userId === '441210049' && userPassword === '123456';
                const adminAuth = userId === 'admin001' && userPassword === 'admin123';

                if (studentAuth && accountType === 'student') {
                    AuthSystem.currentUser = {
                        id: userId,
                        name: 'Bishier Alfadhl',
                        role: 'student',
                        email: 'alfadhl10049@ksau-hs.edu.sa'
                    };
                    AuthSystem.showPortal();
                } else if (adminAuth && accountType === 'admin') {
                    AuthSystem.currentUser = {
                        id: userId,
                        name: 'Administrator',
                        role: 'admin',
                        email: 'admin@ksau-hs.edu.sa'
                    };
                    AuthSystem.showPortal();
                } else {
                    alert('‚ùå Invalid credentials. Please check and try again.\n\nDemo credentials:\nüéì Student: 441210049 / 123456\nüë®‚Äçüíº Admin: admin001 / admin123');
                }
            },

            showPortal: () => {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('portalContainer').classList.remove('hidden');
                
                const userGreeting = document.getElementById('userGreeting');
                const roleIcon = AuthSystem.currentUser.role === 'student' ? 'üéì' : 'üë®‚Äçüíº';
                userGreeting.innerHTML = `${roleIcon} ${AuthSystem.currentUser.name}`;

                StudentPortal.renderHome();
            },

            logout: () => {
                if (confirm('Are you sure you want to logout?')) {
                    AuthSystem.currentUser = null;
                    document.getElementById('portalContainer').classList.add('hidden');
                    document.getElementById('loginContainer').style.display = 'flex';
                    document.getElementById('userId').value = '';
                    document.getElementById('userPassword').value = '';
                    AuthSystem.selectAccountType('student');
                }
            }
        };

        // ============================================================
        // USER ROLE TRACKING
        // ============================================================
        let currentUserRole = 'student';

        // ============================================================
        // STUDENT PORTAL DATA MANAGER
        // ============================================================
        const StudentPortalManager = {
            currentStudent: {
                studentId: '441210049',
                firstName: 'Bishier',
                lastName: 'Alfadhl',
                email: 'alfadhl10049@ksau-hs.edu.sa',
                phone: '+966501234567',
                program: 'PharmD',
                cohort: 'IPPE II',
                year: '2025-2026',
                gpa: 3.9,
                academicStanding: 'Good'
            },

            departments: [
                { id: 'academic', name: 'Academic Affairs', email: 'academic@ksau-hs.edu.sa', color: '#1B5E20', icon: 'üìö' },
                { id: 'clinical', name: 'Clinical Affairs', email: 'clinical@ksau-hs.edu.sa', color: '#008080', icon: 'üè•' },
                { id: 'it', name: 'IT Support', email: 'itsupport@ksau-hs.edu.sa', color: '#1565C0', icon: 'üíª' },
                { id: 'student-services', name: 'Student Services', email: 'studentservices@ksau-hs.edu.sa', color: '#6A1B9A', icon: 'üë•' },
                { id: 'research', name: 'Research Unit', email: 'research@ksau-hs.edu.sa', color: '#D32F2F', icon: 'üî¨' }
            ],

            requestTypes: [
                { id: 'letter', name: 'Letter Requests', icon: 'üìÑ', description: 'Training, Enrollment, or Official Letters', department: 'academic' },
                { id: 'clinical', name: 'Clinical/Rotation Issue', icon: 'üè•', description: 'Rotation change, site issue, preceptor concern', department: 'clinical' },
                { id: 'academic-support', name: 'Academic Support', icon: 'üìö', description: 'Tutoring, mentorship, remediation', department: 'academic' },
                { id: 'it-support', name: 'IT Support', icon: 'üíª', description: 'Portal access, technical issues', department: 'it' },
                { id: 'event-participation', name: 'Event/Conference Request', icon: 'üéâ', description: 'Conferences, events, competitions', department: 'student-services' },
                { id: 'general-inquiry', name: 'General Inquiry', icon: '‚ùì', description: 'Other questions or requests', department: 'student-services' }
            ],

            tickets: [
                {
                    ticketId: 'COP-TICKET-2026-000001',
                    studentId: '441210049',
                    title: 'Request Training Letter for Internship',
                    requestType: 'letter',
                    status: 'in-progress',
                    priority: 'high',
                    department: 'academic',
                    submissionDate: new Date(2026, 0, 28, 10, 30),
                    lastUpdate: new Date(2026, 0, 29, 14, 15),
                    assignedTo: { name: 'Dr. Fatima Al-Hajri', email: 'f.alhajri@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 5),
                    sla: '3 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 28, 10, 30), message: 'Hi, I need a training letter for my internship application at XYZ Company. Needed by Feb 5.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Dr. Fatima Al-Hajri', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 28, 15, 45), message: 'Hello Bishier, I received your request. Can you please provide the following details:\n\n1. Specific details about the internship\n2. Company name and contact information\n3. Required format (if any)', attachments: [] },
                        { id: 3, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 29, 9, 20), message: 'Sure! Details attached. Let me know if you need anything else.', attachments: [{ name: 'internship_details.pdf', size: '245 KB', type: 'pdf' }] },
                        { id: 4, sender: 'admin', senderName: 'Dr. Fatima Al-Hajri', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 29, 14, 15), message: 'Perfect! I\'m preparing your letter now. It should be ready by tomorrow. You\'ll receive it via email and can also download it from your portal.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000002',
                    studentId: '441210049',
                    title: 'Rotation Site Change Request',
                    requestType: 'clinical',
                    status: 'submitted',
                    priority: 'medium',
                    department: 'clinical',
                    submissionDate: new Date(2026, 0, 20, 11, 0),
                    lastUpdate: new Date(2026, 0, 29, 14, 0),
                    assignedTo: { name: 'Ahmed Al-Dosari', email: 'a.aldosari@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 1),
                    sla: '5 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 20, 11, 0), message: 'I would like to change my rotation site from Hospital A to Hospital B due to scheduling conflicts.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Ahmed Al-Dosari', senderRole: 'Clinical Affairs Coordinator', timestamp: new Date(2026, 0, 20, 15, 30), message: 'Request received. I will contact Hospital B to confirm availability.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000003',
                    studentId: '441210049',
                    title: 'Transcript Request for Postgraduate Studies',
                    requestType: 'letter',
                    status: 'in-progress',
                    priority: 'high',
                    department: 'academic',
                    submissionDate: new Date(2026, 0, 27, 9, 0),
                    lastUpdate: new Date(2026, 0, 29, 10, 0),
                    assignedTo: { name: 'Dr. Sarah Al-Zahrani', email: 's.alzahrani@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 3),
                    sla: '3 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 27, 9, 0), message: 'I need an official transcript for my postgraduate application. Deadline is Feb 15.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Dr. Sarah Al-Zahrani', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 27, 11, 30), message: 'Request received. Preparing your transcript now.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000004',
                    studentId: '441210049',
                    title: 'LMS Portal Access Issue',
                    requestType: 'it-support',
                    status: 'closed',
                    priority: 'critical',
                    department: 'it',
                    submissionDate: new Date(2026, 0, 15, 8, 0),
                    lastUpdate: new Date(2026, 0, 15, 10, 30),
                    assignedTo: { name: 'Muhammad Al-Otaibi', email: 'm.alotaibi@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 0, 15),
                    sla: '2 hours for critical issues',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 15, 8, 0), message: 'I cannot access the LMS portal. Getting "Access Denied" error. Please help ASAP as I need to submit assignment today.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Muhammad Al-Otaibi', senderRole: 'IT Support', timestamp: new Date(2026, 0, 15, 8, 45), message: 'Working on this. Let me check your account permissions.', attachments: [] },
                        { id: 3, sender: 'admin', senderName: 'Muhammad Al-Otaibi', senderRole: 'IT Support', timestamp: new Date(2026, 0, 15, 10, 30), message: 'Issue resolved! Your access has been restored. Please clear your browser cache and try again. You should be able to access now.', attachments: [] }
                    ]
                }
            ],

            formatDate: (date) => {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(date).toLocaleDateString('en-US', options);
            },

            formatTime: (date) => {
                const options = { hour: '2-digit', minute: '2-digit' };
                return new Date(date).toLocaleTimeString('en-US', options);
            },

            getDepartmentById: (deptId) => {
                return StudentPortalManager.departments.find(d => d.id === deptId);
            },

            getRequestTypeById: (typeId) => {
                return StudentPortalManager.requestTypes.find(t => t.id === typeId);
            }
        };

        // ============================================================
        // RENDER HOME PAGE
        // ============================================================
        function renderStudentPortalHome() {
            const root = document.getElementById('app-root');
            const { formatDate, formatTime } = StudentPortalManager;
            const student = StudentPortalManager.currentStudent;

            const totalTickets = StudentPortalManager.tickets.length;
            const activeTickets = StudentPortalManager.tickets.filter(t => ['submitted', 'in-progress'].includes(t.status)).length;
            const pendingResponse = StudentPortalManager.tickets.filter(t => t.status === 'waiting-student').length;
            const resolvedTickets = StudentPortalManager.tickets.filter(t => ['approved', 'closed', 'resolved'].includes(t.status)).length;

            let html = `
            <div class="student-portal-home">
                <section class="home-section" style="background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%); color: white; margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="margin: 0 0 8px 0;">Welcome, ${student.firstName}! üëã</h2>
                            <p style="margin: 0; opacity: 0.9;">${student.program} ‚Ä¢ ${student.cohort} ‚Ä¢ ${student.year}</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2.5rem; opacity: 0.3;">üìß</div>
                        </div>
                    </div>
                </section>

                <section class="ticket-stats">
                    <div class="stat-card">
                        <div class="stat-number">${totalTickets}</div>
                        <div class="stat-label">Total Tickets</div>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-number">${activeTickets}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-number">${pendingResponse}</div>
                        <div class="stat-label">Awaiting Response</div>
                    </div>
                    <div class="stat-card resolved">
                        <div class="stat-number">${resolvedTickets}</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                </section>

                <section class="home-section">
                    <div class="section-header">
                        <h3>Need Help?</h3>
                    </div>
                    <div class="quick-action-buttons">
                        <button class="action-btn primary" onclick="StudentPortal.showSubmitForm()">
                            <span style="font-size: 1.5rem;">‚ûï</span>
                            <span>Submit New Request</span>
                        </button>
                        <button class="action-btn secondary" onclick="StudentPortal.showAllTickets()">
                            <span style="font-size: 1.5rem;">üìã</span>
                            <span>View All Tickets</span>
                        </button>
                        <button class="action-btn secondary" onclick="StudentPortal.showDashboard()">
                            <span style="font-size: 1.5rem;">üìä</span>
                            <span>Dashboard & Analytics</span>
                        </button>
                    </div>
                </section>

                <section class="home-section">
                    <div class="section-header">
                        <h3>Active Tickets</h3>
                        <a href="#" onclick="StudentPortal.showAllTickets(); return false;" class="view-all">View All ‚Üí</a>
                    </div>
            `;

            const activeTickets_list = StudentPortalManager.tickets.filter(t => ['submitted', 'in-progress'].includes(t.status)).slice(0, 3);
            
            if (activeTickets_list.length > 0) {
                activeTickets_list.forEach(ticket => {
                    const requestType = StudentPortalManager.getRequestTypeById(ticket.requestType);
                    const dept = StudentPortalManager.getDepartmentById(ticket.department);
                    
                    html += `
                    <div class="ticket-preview-card" onclick="StudentPortal.openTicket('${ticket.ticketId}')">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 1.5rem;">${requestType.icon}</span>
                                <div>
                                    <h4 style="margin: 0; color: var(--text-dark);">${ticket.title}</h4>
                                    <small style="color: var(--text-muted);">${ticket.ticketId}</small>
                                </div>
                            </div>
                            <span class="ticket-status-badge ${ticket.status}">${ticket.status.replace('-', ' ')}</span>
                        </div>
                        <div style="display: flex; gap: 20px; font-size: 0.9rem; margin: 10px 0; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <span>üïê ${formatDate(ticket.lastUpdate)}</span>
                            <span>üìå ${dept.name}</span>
                            <span>‚è±Ô∏è SLA: ${ticket.sla}</span>
                        </div>
                        <div style="color: var(--primary-green); font-weight: 600; margin-top: 8px; font-size: 0.9rem;">
                            Click to view conversation ‚Üí
                        </div>
                    </div>
                    `;
                });
            } else {
                html += `
                <div style="padding: 40px; text-align: center; background: var(--light-green); border-radius: 8px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">‚ú®</div>
                    <p style="margin: 0; color: var(--text-muted);">No active tickets. All caught up!</p>
                </div>
                `;
            }

            html += `
                </section>
            </div>
            `;

            root.innerHTML = html;
            document.getElementById('page-title').textContent = 'Home';
        }

        // ============================================================
        // RENDER DASHBOARD
        // ============================================================
        function renderDashboard() {
            try {
                const root = document.getElementById('app-root');
                if (!root) return;

                const tickets = StudentPortalManager.tickets;
                const depts = StudentPortalManager.departments;

                const totalReq = tickets.length;
                const inProgress = tickets.filter(t => t.status === 'in-progress').length;
                const resolved = tickets.filter(t => ['approved', 'closed', 'resolved'].includes(t.status)).length;
                const waiting = tickets.filter(t => t.status === 'waiting-student').length;
                const submitted = tickets.filter(t => t.status === 'submitted').length;
                
                const today = new Date();
                const overdue = tickets.filter(t => t.dueDate && new Date(t.dueDate) < today && !['closed', 'resolved'].includes(t.status)).length;

                let html = `
                <div class="student-portal-home" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); margin: -30px -30px 0 -30px; padding: 30px;">
                    <div style="max-width: 1400px; margin: 0 auto;">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                            <div>
                                <h1 style="margin: 0; font-size: 2.5rem; color: #1a1a1a; font-weight: 700;">
                                    üìä Dashboard
                                </h1>
                                <p style="margin: 8px 0 0 0; color: #666; font-size: 1rem;">Overview of your ticket requests and performance metrics</p>
                            </div>
                        </div>

                        <div style="margin-bottom: 40px;">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin-bottom: 20px;">Key Metrics</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                
                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #4CAF50;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Requests</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #4CAF50;">${totalReq}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">All submitted requests</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚úÖ</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #2196F3;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">In Progress</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #2196F3;">${inProgress}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Being processed</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">üïí</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #9C27B0;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Resolved</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #9C27B0;">${resolved}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Completed</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚úîÔ∏è</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #FF9800;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Awaiting You</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #FF9800;">${waiting}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Need your action</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚è≥</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #F44336;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Overdue</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #F44336;">${overdue}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">SLA breached</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚ö†Ô∏è</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #00BCD4;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Success Rate</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #00BCD4;">${totalReq > 0 ? Math.round((resolved / totalReq) * 100) : 0}%</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Resolution rate</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">üìà</div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 40px;">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin: 0 0 25px 0;">Requests by Department</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">`;

                for (let i = 0; i < depts.length; i++) {
                    const dept = depts[i];
                    const count = tickets.filter(t => t.department === dept.id).length;
                    const pct = totalReq > 0 ? Math.round((count / totalReq) * 100) : 0;
                    
                    html += `
                                <div style="padding: 20px; background: ${dept.color}08; border-radius: 10px; border: 1px solid ${dept.color}20;">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <div style="font-size: 1.8rem; margin-right: 12px;">${dept.icon}</div>
                                        <div>
                                            <div style="font-weight: 600; color: #1a1a1a; font-size: 1rem;">${dept.name}</div>
                                            <div style="color: #999; font-size: 0.85rem;">${count} request${count !== 1 ? 's' : ''}</div>
                                        </div>
                                    </div>
                                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                                        <div style="background: ${dept.color}; height: 100%; width: ${pct}%; transition: width 0.3s ease;"></div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #666; font-size: 0.9rem; font-weight: 600;">${pct}% of total</span>
                                        <span style="background: ${dept.color}20; color: ${dept.color}; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">${count}</span>
                                    </div>
                                </div>`;
                }

                html += `
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin: 0 0 20px 0;">üìà Quick Summary</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; color: white;">
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Active Requests</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">${inProgress + submitted}</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">Currently being worked on</p>
                                </div>
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Completion Rate</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">${totalReq > 0 ? Math.round((resolved / totalReq) * 100) : 0}%</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">Out of all requests</p>
                                </div>
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Average Status</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">üü¢</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">${overdue === 0 ? 'All on track' : overdue + ' need attention'}</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                `;

                root.innerHTML = html;
                
            } catch (error) {
                console.error('Error rendering dashboard:', error);
            }
        }

        // ============================================================
        // RENDER ALL TICKETS
        // ============================================================
        function renderAllTickets() {
            const root = document.getElementById('app-root');
            const { formatDate } = StudentPortalManager;

            let html = `
            <div class="student-portal-home">
                <div class="section-header" style="margin-bottom: 30px;">
                    <h3>My Tickets</h3>
                </div>

                <section class="home-section" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="filter-btn active" onclick="StudentPortal.showAllTickets()">All (${StudentPortalManager.tickets.length})</button>
                        <button class="filter-btn" onclick="StudentPortal.filterTickets('active')">Active</button>
                        <button class="filter-btn" onclick="StudentPortal.filterTickets('resolved')">Resolved</button>
                    </div>
                </section>

                <section class="home-section">
            `;

            StudentPortalManager.tickets.forEach(ticket => {
                const requestType = StudentPortalManager.getRequestTypeById(ticket.requestType);
                const dept = StudentPortalManager.getDepartmentById(ticket.department);
                const messageCount = ticket.messages.length;

                html += `
                <div class="ticket-card" onclick="StudentPortal.openTicket('${ticket.ticketId}')">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="display: flex; gap: 10px; align-items: start; flex: 1;">
                            <span style="font-size: 1.8rem;">${requestType.icon}</span>
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 4px 0;">${ticket.title}</h4>
                                <small style="color: var(--text-muted);">${ticket.ticketId}</small>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; font-size: 0.9rem; margin-top: 12px; padding-top: 12px; border-top: 1px solid #ddd;">
                                    <div>
                                        <small style="color: var(--text-muted); display: block;">Department</small>
                                        <strong>${dept.name}</strong>
                                    </div>
                                    <div>
                                        <small style="color: var(--text-muted); display: block;">Submitted</small>
                                        <strong>${formatDate(ticket.submissionDate)}</strong>
                                    </div>
                                    <div>
                                        <small style="color: var(--text-muted); display: block;">Assigned To</small>
                                        <strong>${ticket.assignedTo.name}</strong>
                                    </div>
                                    <div>
                                        <small style="color: var(--text-muted); display: block;">Messages</small>
                                        <strong>üí¨ ${messageCount}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="ticket-status-badge ${ticket.status}">${ticket.status.replace('-', ' ')}</span>
                        </div>
                    </div>
                </div>
                `;
            });

            html += `
                </section>
            </div>
            `;

            root.innerHTML = html;
            document.getElementById('page-title').textContent = 'My Tickets';
        }

        // ============================================================
        // RENDER TICKET DETAIL
        // ============================================================
        function renderTicketDetail(ticketId) {
            const root = document.getElementById('app-root');
            const ticket = StudentPortalManager.tickets.find(t => t.ticketId === ticketId);
            const { formatDate, formatTime } = StudentPortalManager;
            
            if (!ticket) return;

            const requestType = StudentPortalManager.getRequestTypeById(ticket.requestType);
            const dept = StudentPortalManager.getDepartmentById(ticket.department);

            let html = `
            <div class="student-portal-home">
                <div class="section-header" style="margin-bottom: 20px;">
                    <div>
                        <h3>${ticket.title}</h3>
                        <small style="color: var(--text-muted);">${ticket.ticketId}</small>
                    </div>
                    <button class="btn btn-outline" onclick="StudentPortal.showAllTickets()">‚Üê Back</button>
                </div>

                <section class="home-section" style="background: ${dept.color}05; border-left: 4px solid ${dept.color};">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <small style="color: var(--text-muted);">Status</small>
                            <div style="margin-top: 5px;">
                                <span class="ticket-status-badge ${ticket.status}">${ticket.status.replace('-', ' ')}</span>
                            </div>
                        </div>
                        <div>
                            <small style="color: var(--text-muted);">Department</small>
                            <p style="margin: 5px 0 0 0;"><strong>${dept.name}</strong></p>
                        </div>
                        <div>
                            <small style="color: var(--text-muted);">Assigned To</small>
                            <p style="margin: 5px 0 0 0;"><strong>${ticket.assignedTo.name}</strong></p>
                        </div>
                        <div>
                            <small style="color: var(--text-muted);">Response SLA</small>
                            <p style="margin: 5px 0 0 0;"><strong>${ticket.sla}</strong></p>
                        </div>
                    </div>
                </section>

                <section class="home-section">
                    <h4 style="margin-bottom: 20px; color: var(--primary-green);">Conversation History</h4>
                    <div class="conversation-thread">
            `;

            ticket.messages.forEach(msg => {
                const isStudent = msg.sender === 'student';
                html += `
                <div class="message ${isStudent ? 'from-student' : 'from-admin'}">
                    <div class="message-header">
                        <div>
                            <strong>${msg.senderName}</strong>
                            <small style="color: var(--text-muted);">${msg.senderRole}</small>
                        </div>
                        <small style="color: var(--text-muted);">${formatDate(msg.timestamp)} ${formatTime(msg.timestamp)}</small>
                    </div>
                    <div class="message-body">${msg.message}</div>
                    ${msg.attachments && msg.attachments.length > 0 ? `
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1);">
                        ${msg.attachments.map(att => `<div style="color: var(--text-muted); font-size: 0.9rem;">üìé ${att.name} (${att.size})</div>`).join('')}
                    </div>
                    ` : ''}
                </div>
                `;
            });

            html += `
                    </div>
                </section>

                <section class="home-section" style="background: var(--light-green); border-left: 4px solid var(--primary-green);">
                    <h4 style="margin-bottom: 15px; color: var(--primary-green);">Send Reply</h4>
                    <form onsubmit="StudentPortal.sendReply(event, '${ticketId}')">
                        <div class="form-group">
                            <textarea placeholder="Type your message here..." rows="5" required></textarea>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Send Message</button>
                            <button type="button" class="btn btn-outline" onclick="StudentPortal.showAllTickets()" style="flex: 1;">Back to Tickets</button>
                        </div>
                    </form>
                </section>
            </div>
            `;

            root.innerHTML = html;
            document.getElementById('page-title').textContent = `Ticket: ${ticket.ticketId}`;
        }

        // ============================================================
        // RENDER SUBMIT FORM
        // ============================================================
        function renderSubmitRequestForm() {
            const root = document.getElementById('app-root');

            let html = `
            <div class="student-portal-home">
                <div class="section-header" style="margin-bottom: 30px;">
                    <h3>Submit New Request</h3>
                    <button class="btn btn-outline" onclick="StudentPortal.renderHome()">‚Üê Back</button>
                </div>

                <section class="home-section">
                    <h4 style="margin-bottom: 20px; color: var(--primary-green);">Select Request Type</h4>
                    <div class="request-type-grid">
            `;

            StudentPortalManager.requestTypes.forEach(type => {
                html += `
                <div class="request-type-card" onclick="StudentPortal.showRequestForm('${type.id}')">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">${type.icon}</div>
                    <h5 style="margin: 0 0 5px 0; color: var(--text-dark);">${type.name}</h5>
                    <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">${type.description}</p>
                    <div style="margin-top: 10px; font-size: 0.85rem; color: var(--primary-green); font-weight: 500;">
                        Select ‚Üí
                    </div>
                </div>
                `;
            });

            html += `
                    </div>
                </section>
            </div>
            `;

            root.innerHTML = html;
            document.getElementById('page-title').textContent = 'Submit New Request';
        }

        // ============================================================
        // STUDENT PORTAL API
        // ============================================================
        window.StudentPortal = {
            renderHome: () => {
                renderStudentPortalHome();
            },
            showDashboard: () => {
                document.getElementById('page-title').textContent = 'Dashboard & Analytics';
                setTimeout(() => renderDashboard(), 10);
            },
            showSubmitForm: () => {
                renderSubmitRequestForm();
            },
            showRequestForm: (typeId) => {
                const type = StudentPortalManager.getRequestTypeById(typeId);
                document.getElementById('page-title').textContent = `New Request: ${type.name}`;
                alert('‚ú® Form coming soon! Feature will be enhanced soon.');
                StudentPortal.renderHome();
            },
            showAllTickets: () => {
                renderAllTickets();
            },
            filterTickets: (filter) => {
                alert('üîç Filtering for: ' + filter);
                StudentPortal.showAllTickets();
            },
            openTicket: (ticketId) => {
                renderTicketDetail(ticketId);
            },
            sendReply: (event, ticketId) => {
                event.preventDefault();
                alert('‚úÖ Message sent successfully!');
                StudentPortal.openTicket(ticketId);
            }
        };
    </script>
</body>
</html>
