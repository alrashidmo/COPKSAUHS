<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - Ticket Tracking System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        :root {
            --primary-green: #1B5E20;
            --light-green: #E8F5E9;
            --text-dark: #1a1a1a;
            --text-muted: #666;
            --border-color: #e0e0e0;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .global-nav {
            background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .global-nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .global-nav-menu {
            list-style: none;
            display: flex;
            gap: 30px;
        }

        .global-nav-link {
            color: white;
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .global-nav-link:hover {
            opacity: 0.8;
        }

        .global-nav-link.active {
            border-bottom: 3px solid white;
            padding-bottom: 5px;
        }

        .unit-nav-container {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
            width: 250px;
            min-height: calc(100vh - 80px);
        }

        .sidebar.hidden {
            display: none;
        }

        .sidebar .brand {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 20px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: #666;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: var(--light-green);
            color: var(--primary-green);
        }

        .nav-link.active {
            background: var(--light-green);
            color: var(--primary-green);
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            overflow: auto;
        }

        .top-bar {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary-green);
            color: white;
        }

        .btn-primary:hover {
            background: #0D3B12;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--primary-green);
            color: var(--primary-green);
        }

        .btn-outline:hover {
            background: var(--light-green);
        }

        .content-area {
            padding: 30px;
        }

        .student-portal-home {
            max-width: 1400px;
            margin: 0 auto;
        }

        .home-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            font-size: 1.3rem;
            color: var(--primary-green);
        }

        .ticket-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #1B5E20;
            text-align: center;
        }

        .stat-card.active {
            border-left-color: #2196F3;
        }

        .stat-card.pending {
            border-left-color: #FF9800;
        }

        .stat-card.resolved {
            border-left-color: #9C27B0;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-green);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .quick-action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(27, 94, 32, 0.3);
        }

        .action-btn.secondary {
            background: var(--light-green);
            color: var(--primary-green);
        }

        .action-btn.secondary:hover {
            background: #C8E6C9;
        }

        .btn-icon {
            font-size: 1.5rem;
        }

        .btn-text {
            font-size: 0.95rem;
        }

        .ticket-preview-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-green);
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ticket-preview-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .ticket-status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .ticket-status-badge.submitted {
            background: #BBDEFB;
            color: #1565C0;
        }

        .ticket-status-badge.in-progress {
            background: #FFE0B2;
            color: #E65100;
        }

        .ticket-status-badge.closed {
            background: #C8E6C9;
            color: #1B5E20;
        }

        .ticket-status-badge.resolved {
            background: #C8E6C9;
            color: #1B5E20;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
        }

        .conversation-thread {
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .message.from-student {
            background: var(--light-green);
            margin-left: 40px;
        }

        .message.from-admin {
            background: #F5F5F5;
            margin-right: 40px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .message-header strong {
            font-weight: 600;
        }

        .message-body {
            color: var(--text-dark);
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                min-height: auto;
            }

            .global-nav-menu {
                gap: 15px;
                font-size: 0.9rem;
            }

            .global-nav {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .page-title {
                font-size: 1.3rem;
            }

            .user-actions {
                flex-wrap: wrap;
                font-size: 0.9rem;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Global Navigation -->
        <nav class="global-nav">
            <div class="global-nav-brand">
                <span>üèõÔ∏è</span> College of Pharmacy
            </div>
            <ul class="global-nav-menu">
                <li>
                    <a class="global-nav-link active" onclick="showPortal(); return false;" style="cursor: pointer;">üë®‚Äçüéì Student Portal</a>
                </li>
            </ul>
        </nav>

        <!-- Unit Navigation -->
        <div class="unit-nav-container">
            <aside class="sidebar" id="nav-student-portal">
                <div class="brand">üë®‚Äçüéì Student Portal</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="StudentPortal.renderHome(); return false;">
                            <span class="nav-icon">üè†</span> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="StudentPortal.showDashboard(); return false;">
                            <span class="nav-icon">üìä</span> Dashboard
                        </a>
                    </li>
                </ul>
            </aside>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title" id="page-title">Welcome</h1>
                <div class="user-actions">
                    <button class="btn btn-outline" onclick="StudentPortal.switchUserRole('student')">üéì Student Mode</button>
                    <button class="btn btn-outline" onclick="StudentPortal.switchUserRole('admin')">üë®‚Äçüíº Admin Mode</button>
                </div>
            </header>

            <div class="content-area" id="app-root">
                <div class="home-section" style="text-align: center; padding: 60px 20px;">
                    <p style="font-size: 3rem; margin-bottom: 20px;">üëã</p>
                    <h2 style="color: var(--primary-green); margin-bottom: 10px;">Welcome to Student Portal</h2>
                    <p style="color: var(--text-muted); margin-bottom: 30px;">Click Home or Dashboard in the sidebar to get started</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ============================================================
        // USER ROLE TRACKING
        // ============================================================
        let currentUserRole = 'student';

        // ============================================================
        // STUDENT PORTAL API FALLBACK
        // ============================================================
        if (typeof StudentPortalAPI === 'undefined') {
            window.StudentPortalAPI = {
                async getStudentTickets(studentId) {
                    return [];
                },
                async createTicket(ticketData) {
                    return {
                        ticketId: 'COP-TICKET-2026-' + Math.floor(Math.random() * 10000).toString().padStart(6, '0'),
                        dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString()
                    };
                }
            };
        }

        // ============================================================
        // STUDENT PORTAL DATA MANAGER
        // ============================================================
        const StudentPortalManager = {
            currentStudent: {
                studentId: '441210049',
                firstName: 'Bishier',
                lastName: 'Alfadhl',
                email: 'alfadhl10049@ksau-hs.edu.sa',
                phone: '+966501234567',
                program: 'PharmD',
                cohort: 'IPPE II',
                year: '2025-2026',
                gpa: 3.9,
                academicStanding: 'Good'
            },

            departments: [
                { id: 'academic', name: 'Academic Affairs', email: 'academic@ksau-hs.edu.sa', color: '#1B5E20', icon: 'üìö' },
                { id: 'clinical', name: 'Clinical Affairs', email: 'clinical@ksau-hs.edu.sa', color: '#008080', icon: 'üè•' },
                { id: 'it', name: 'IT Support', email: 'itsupport@ksau-hs.edu.sa', color: '#1565C0', icon: 'üíª' },
                { id: 'student-services', name: 'Student Services', email: 'studentservices@ksau-hs.edu.sa', color: '#6A1B9A', icon: 'üë•' },
                { id: 'research', name: 'Research Unit', email: 'research@ksau-hs.edu.sa', color: '#D32F2F', icon: 'üî¨' }
            ],

            requestTypes: [
                { id: 'letter', name: 'Letter Requests', icon: 'üìÑ', description: 'Training, Enrollment, or Official Letters', department: 'academic', icon_detail: 'üìã' },
                { id: 'clinical', name: 'Clinical/Rotation Issue', icon: 'üè•', description: 'Rotation change, site issue, preceptor concern', department: 'clinical', icon_detail: '‚ö†Ô∏è' },
                { id: 'academic-support', name: 'Academic Support', icon: 'üìö', description: 'Tutoring, mentorship, remediation', department: 'academic', icon_detail: 'üéì' },
                { id: 'it-support', name: 'IT Support', icon: 'üíª', description: 'Portal access, technical issues', department: 'it', icon_detail: 'üîß' },
                { id: 'event-participation', name: 'Event/Conference Request', icon: 'üéâ', description: 'Conferences, events, competitions', department: 'student-services', icon_detail: 'üéä' },
                { id: 'general-inquiry', name: 'General Inquiry', icon: '‚ùì', description: 'Other questions or requests', department: 'student-services', icon_detail: 'üí¨' }
            ],

            tickets: [
                {
                    ticketId: 'COP-TICKET-2026-000001',
                    studentId: '441210049',
                    title: 'Request Training Letter for Internship',
                    requestType: 'letter',
                    status: 'in-progress',
                    priority: 'high',
                    department: 'academic',
                    submissionDate: new Date(2026, 0, 28, 10, 30),
                    lastUpdate: new Date(2026, 0, 29, 14, 15),
                    assignedTo: { name: 'Dr. Fatima Al-Hajri', email: 'f.alhajri@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 5),
                    sla: '3 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 28, 10, 30), message: 'Hi, I need a training letter for my internship application at XYZ Company. Needed by Feb 5.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Dr. Fatima Al-Hajri', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 28, 15, 45), message: 'Hello Bishier, I received your request. Can you please provide the following details:\n\n1. Specific details about the internship\n2. Company name and contact information\n3. Required format (if any)', attachments: [] },
                        { id: 3, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 29, 9, 20), message: 'Sure! Details attached. Let me know if you need anything else.', attachments: [{ name: 'internship_details.pdf', size: '245 KB', type: 'pdf' }] },
                        { id: 4, sender: 'admin', senderName: 'Dr. Fatima Al-Hajri', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 29, 14, 15), message: 'Perfect! I\'m preparing your letter now. It should be ready by tomorrow. You\'ll receive it via email and can also download it from your portal.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000002',
                    studentId: '441210049',
                    title: 'Rotation Site Change Request',
                    requestType: 'clinical',
                    status: 'submitted',
                    priority: 'medium',
                    department: 'clinical',
                    submissionDate: new Date(2026, 0, 20, 11, 0),
                    lastUpdate: new Date(2026, 0, 29, 14, 0),
                    assignedTo: { name: 'Ahmed Al-Dosari', email: 'a.aldosari@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 1),
                    sla: '5 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 20, 11, 0), message: 'I would like to change my rotation site from Hospital A to Hospital B due to scheduling conflicts.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Ahmed Al-Dosari', senderRole: 'Clinical Affairs Coordinator', timestamp: new Date(2026, 0, 20, 15, 30), message: 'Request received. I will contact Hospital B to confirm availability.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000003',
                    studentId: '441210049',
                    title: 'Transcript Request for Postgraduate Studies',
                    requestType: 'letter',
                    status: 'in-progress',
                    priority: 'high',
                    department: 'academic',
                    submissionDate: new Date(2026, 0, 27, 9, 0),
                    lastUpdate: new Date(2026, 0, 29, 10, 0),
                    assignedTo: { name: 'Dr. Sarah Al-Zahrani', email: 's.alzahrani@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 1, 3),
                    sla: '3 working days',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 27, 9, 0), message: 'I need an official transcript for my postgraduate application. Deadline is Feb 15.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Dr. Sarah Al-Zahrani', senderRole: 'Academic Affairs Coordinator', timestamp: new Date(2026, 0, 27, 11, 30), message: 'Request received. Preparing your transcript now.', attachments: [] }
                    ]
                },
                {
                    ticketId: 'COP-TICKET-2026-000004',
                    studentId: '441210049',
                    title: 'LMS Portal Access Issue',
                    requestType: 'it-support',
                    status: 'closed',
                    priority: 'critical',
                    department: 'it',
                    submissionDate: new Date(2026, 0, 15, 8, 0),
                    lastUpdate: new Date(2026, 0, 15, 10, 30),
                    assignedTo: { name: 'Muhammad Al-Otaibi', email: 'm.alotaibi@ksau-hs.edu.sa' },
                    dueDate: new Date(2026, 0, 15),
                    sla: '2 hours for critical issues',
                    messages: [
                        { id: 1, sender: 'student', senderName: 'Bishier Alfadhl', senderRole: 'Student', timestamp: new Date(2026, 0, 15, 8, 0), message: 'I cannot access the LMS portal. Getting "Access Denied" error. Please help ASAP as I need to submit assignment today.', attachments: [] },
                        { id: 2, sender: 'admin', senderName: 'Muhammad Al-Otaibi', senderRole: 'IT Support', timestamp: new Date(2026, 0, 15, 8, 45), message: 'Working on this. Let me check your account permissions.', attachments: [] },
                        { id: 3, sender: 'admin', senderName: 'Muhammad Al-Otaibi', senderRole: 'IT Support', timestamp: new Date(2026, 0, 15, 10, 30), message: 'Issue resolved! Your access has been restored. Please clear your browser cache and try again. You should be able to access now.', attachments: [] }
                    ]
                }
            ],

            formatDate: (date) => {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(date).toLocaleDateString('en-US', options);
            },

            formatTime: (date) => {
                const options = { hour: '2-digit', minute: '2-digit' };
                return new Date(date).toLocaleTimeString('en-US', options);
            },

            getDepartmentById: (deptId) => {
                return StudentPortalManager.departments.find(d => d.id === deptId);
            },

            getRequestTypeById: (typeId) => {
                return StudentPortalManager.requestTypes.find(t => t.id === typeId);
            },

            generateTicketId: () => {
                const timestamp = new Date();
                const year = timestamp.getFullYear();
                const random = Math.floor(Math.random() * 10000).toString().padStart(6, '0');
                return `COP-TICKET-${year}-${random}`;
            }
        };

        // ============================================================
        // RENDER HOME PAGE
        // ============================================================
        function renderStudentPortalHome() {
            const root = document.getElementById('app-root');
            const { formatDate, formatTime } = StudentPortalManager;
            const student = StudentPortalManager.currentStudent;

            const totalTickets = StudentPortalManager.tickets.length;
            const activeTickets = StudentPortalManager.tickets.filter(t => ['submitted', 'in-progress'].includes(t.status)).length;
            const pendingResponse = StudentPortalManager.tickets.filter(t => t.status === 'waiting-student').length;
            const resolvedTickets = StudentPortalManager.tickets.filter(t => ['approved', 'closed', 'resolved'].includes(t.status)).length;

            let html = `
            <div class="student-portal-home">
                <section class="home-section" style="background: linear-gradient(135deg, #1B5E20 0%, #0D3B12 100%); color: white; margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="margin: 0 0 8px 0;">Welcome, ${student.firstName}! üëã</h2>
                            <p style="margin: 0; opacity: 0.9;">${student.program} ‚Ä¢ ${student.cohort} ‚Ä¢ ${student.year}</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2.5rem; opacity: 0.3;">üìß</div>
                        </div>
                    </div>
                </section>

                <section class="ticket-stats">
                    <div class="stat-card">
                        <div class="stat-number">${totalTickets}</div>
                        <div class="stat-label">Total Tickets</div>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-number">${activeTickets}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-number">${pendingResponse}</div>
                        <div class="stat-label">Awaiting Response</div>
                    </div>
                    <div class="stat-card resolved">
                        <div class="stat-number">${resolvedTickets}</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                </section>

                <section class="home-section">
                    <div class="section-header">
                        <h3>Need Help?</h3>
                    </div>
                    <div class="quick-action-buttons">
                        <button class="action-btn primary" onclick="StudentPortal.showSubmitForm()">
                            <span class="btn-icon">‚ûï</span>
                            <span class="btn-text">Submit New Request</span>
                        </button>
                        <button class="action-btn secondary" onclick="StudentPortal.showAllTickets()">
                            <span class="btn-icon">üìã</span>
                            <span class="btn-text">View All Tickets</span>
                        </button>
                        <button class="action-btn secondary" onclick="StudentPortal.showKnowledgeBase()">
                            <span class="btn-icon">‚ùì</span>
                            <span class="btn-text">FAQ & Help</span>
                        </button>
                    </div>
                </section>

                <section class="home-section">
                    <div class="section-header">
                        <h3>Active Tickets</h3>
                        <a href="#" onclick="StudentPortal.showAllTickets(); return false;" style="color: var(--primary-green); text-decoration: none; font-weight: 600;">View All ‚Üí</a>
                    </div>
            `;

            const activeTickets_list = StudentPortalManager.tickets.filter(t => ['submitted', 'in-progress'].includes(t.status)).slice(0, 3);
            
            if (activeTickets_list.length > 0) {
                activeTickets_list.forEach(ticket => {
                    const requestType = StudentPortalManager.getRequestTypeById(ticket.requestType);
                    const dept = StudentPortalManager.getDepartmentById(ticket.department);
                    
                    html += `
                    <div class="ticket-preview-card" onclick="StudentPortal.openTicket('${ticket.ticketId}')">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 1.5rem;">${requestType.icon}</span>
                                <div>
                                    <h4 style="margin: 0; color: var(--text-dark);">${ticket.title}</h4>
                                    <small style="color: var(--text-muted);">${ticket.ticketId}</small>
                                </div>
                            </div>
                            <span class="ticket-status-badge ${ticket.status}">${ticket.status.replace('-', ' ')}</span>
                        </div>
                        <div style="display: flex; gap: 20px; font-size: 0.9rem; margin: 10px 0; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <span>üïê ${formatDate(ticket.lastUpdate)}</span>
                            <span>üìå ${dept.name}</span>
                            <span>‚è±Ô∏è SLA: ${ticket.sla}</span>
                        </div>
                        <div style="color: var(--primary-green); font-weight: 600; margin-top: 8px; font-size: 0.9rem;">
                            Click to view conversation ‚Üí
                        </div>
                    </div>
                    `;
                });
            } else {
                html += `
                <div style="padding: 40px; text-align: center; background: var(--light-green); border-radius: 8px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">‚ú®</div>
                    <p style="margin: 0; color: var(--text-muted);">No active tickets. All caught up!</p>
                </div>
                `;
            }

            html += `
                </section>
            </div>
            `;

            root.innerHTML = html;
            document.getElementById('page-title').textContent = 'Home';
        }

        // ============================================================
        // RENDER DASHBOARD
        // ============================================================
        function renderDashboard() {
            try {
                const root = document.getElementById('app-root');
                if (!root) {
                    console.error('ERROR: app-root element not found!');
                    return;
                }

                const tickets = StudentPortalManager.tickets;
                const depts = StudentPortalManager.departments;

                const totalReq = tickets.length;
                const inProgress = tickets.filter(t => t.status === 'in-progress').length;
                const resolved = tickets.filter(t => ['approved', 'closed', 'resolved'].includes(t.status)).length;
                const waiting = tickets.filter(t => t.status === 'waiting-student').length;
                const submitted = tickets.filter(t => t.status === 'submitted').length;
                
                const today = new Date();
                const overdue = tickets.filter(t => t.dueDate && new Date(t.dueDate) < today && !['closed', 'resolved'].includes(t.status)).length;

                let html = `
                <div class="student-portal-home" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 30px 0;">
                    <div style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                            <div>
                                <h1 style="margin: 0; font-size: 2.5rem; color: #1a1a1a; font-weight: 700;">
                                    üìä Dashboard
                                </h1>
                                <p style="margin: 8px 0 0 0; color: #666; font-size: 1rem;">Overview of your ticket requests and performance metrics</p>
                            </div>
                            <button class="btn btn-outline" onclick="StudentPortal.renderHome()" style="padding: 10px 20px; font-size: 0.95rem; border-radius: 8px; background: white; border: 2px solid #1B5E20; color: #1B5E20; cursor: pointer; font-weight: 600;">
                                ‚Üê Back to Home
                            </button>
                        </div>

                        <div style="margin-bottom: 40px;">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin-bottom: 20px;">Key Metrics</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                
                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #4CAF50;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Requests</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #4CAF50;">${totalReq}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">All submitted requests</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚úÖ</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #2196F3;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">In Progress</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #2196F3;">${inProgress}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Being processed</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">üïí</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #9C27B0;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Resolved</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #9C27B0;">${resolved}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Completed</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚úîÔ∏è</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #FF9800;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Awaiting You</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #FF9800;">${waiting}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Need your action</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚è≥</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #F44336;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Overdue</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #F44336;">${overdue}</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">SLA breached</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">‚ö†Ô∏è</div>
                                    </div>
                                </div>

                                <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #00BCD4;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Success Rate</p>
                                            <div style="font-size: 2.8rem; font-weight: 700; color: #00BCD4;">${totalReq > 0 ? Math.round((resolved / totalReq) * 100) : 0}%</div>
                                            <p style="margin: 8px 0 0 0; color: #999; font-size: 0.85rem;">Resolution rate</p>
                                        </div>
                                        <div style="font-size: 2.5rem; opacity: 0.15;">üìà</div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 40px;">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin: 0 0 25px 0;">Requests by Department</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">`;

                for (let i = 0; i < depts.length; i++) {
                    const dept = depts[i];
                    const count = tickets.filter(t => t.department === dept.id).length;
                    const pct = totalReq > 0 ? Math.round((count / totalReq) * 100) : 0;
                    
                    html += `
                                <div style="padding: 20px; background: ${dept.color}08; border-radius: 10px; border: 1px solid ${dept.color}20;">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <div style="font-size: 1.8rem; margin-right: 12px;">${dept.icon}</div>
                                        <div>
                                            <div style="font-weight: 600; color: #1a1a1a; font-size: 1rem;">${dept.name}</div>
                                            <div style="color: #999; font-size: 0.85rem;">${count} request${count !== 1 ? 's' : ''}</div>
                                        </div>
                                    </div>
                                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                                        <div style="background: ${dept.color}; height: 100%; width: ${pct}%; transition: width 0.3s ease;"></div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #666; font-size: 0.9rem; font-weight: 600;">${pct}% of total</span>
                                        <span style="background: ${dept.color}20; color: ${dept.color}; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">${count}</span>
                                    </div>
                                </div>`;
                }

                html += `
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);">
                            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin: 0 0 20px 0;">üìà Quick Summary</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; color: white;">
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Active Requests</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">${inProgress + submitted}</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">Currently being worked on</p>
                                </div>
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Completion Rate</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">${totalReq > 0 ? Math.round((resolved / totalReq) * 100) : 0}%</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">Out of all requests</p>
                                </div>
                                <div>
                                    <p style="margin: 0 0 5px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">Average Status</p>
                                    <p style="margin: 0; font-size: 2rem; font-weight: 700;">üü¢</p>
                                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">${overdue === 0 ? 'All on track' : overdue + ' need attention'}</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                `;

                root.innerHTML = html;
                document.getElementById('page-title').textContent = 'Dashboard & Analytics';
                
            } catch (error) {
                console.error('Error rendering dashboard:', error);
                const root = document.getElementById('app-root');
                if (root) {
                    root.innerHTML = '<div style="padding: 30px; background: #ffebee; border-radius: 12px; color: #c62828;"><h3 style="margin: 0 0 10px 0;">Error Loading Dashboard</h3><p style="margin: 0;">' + error.message + '</p></div>';
                }
            }
        }

        // ============================================================
        // STUDENT PORTAL EXPORT
        // ============================================================
        window.StudentPortal = {
            renderHome: async () => {
                renderStudentPortalHome();
            },
            showDashboard: () => {
                try {
                    const pageTitle = document.getElementById('page-title');
                    if (pageTitle) pageTitle.textContent = 'Dashboard & Analytics';
                    setTimeout(() => renderDashboard(), 100);
                } catch (error) {
                    console.error('Dashboard error:', error);
                }
            },
            showSubmitForm: () => {
                alert('‚ú® Feature Coming Soon!\n\nSubmit request form will be available soon.');
            },
            showAllTickets: () => {
                alert('üìã View All Tickets\n\nYou have ' + StudentPortalManager.tickets.length + ' total tickets.');
            },
            showKnowledgeBase: () => {
                alert('‚ùì FAQ & Help Center\n\nHelp resources coming soon.');
            },
            switchUserRole: (role) => {
                currentUserRole = role;
                alert(`‚úÖ Switched to ${role === 'admin' ? 'Admin' : 'Student'} mode`);
                StudentPortal.renderHome();
            },
            openTicket: (ticketId) => {
                alert('üé´ Ticket: ' + ticketId + '\n\nTicket details coming soon.');
            }
        };

        function showPortal() {
            document.getElementById('nav-student-portal').classList.remove('hidden');
            StudentPortal.renderHome();
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            showPortal();
        });
    </script>
</body>
</html>
